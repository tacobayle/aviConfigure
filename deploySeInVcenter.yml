---
- name:  deploy Avi serviceengine
  vmware_deploy_ovf:
    hostname: '{{ vcenter.hostname }}'
    username: '{{ vcenter.username }}'
    password: '{{ vcenter.password }}'
    #folder: "{{ vcenter.folder | default('SDDC-Datacenter/aviSe',true) }}"
    datacenter: "{{ vcenter.datacenter | default('SDDC-Datacenter',true) }}"
    cluster: "{{ vcenter.cluster | default('Cluster-1',true) }}"
    datastore: "{{ vcenter.datastore | default('WorkloadDatastore',true) }}"
    name: "{{ 'aviSe%02x' | format(item) }}"
    validate_certs: False
    networks:
      Management: "{{ vcenter.networkManagementSe | default('default',true) }}"
      Data Network 1: "{{ vcenter.networkVipSe | default('default',true) }}"
      Data Network 2: "{{ vcenter.networkBackendSe | default('default',true) }}"
      Data Network 3: "{{ data_network3.se_int_pg | default('default',true) }}"
      Data Network 4: "{{ data_network4.se_int_pg | default('default',true) }}"
      Data Network 5: "{{ data_network5.se_int_pg | default('default',true) }}"
      Data Network 6: "{{ data_network6.se_int_pg | default('default',true) }}"
      Data Network 7: "{{ data_network7.se_int_pg | default('default',true) }}"
      Data Network 8: "{{ data_network8.se_int_pg | default('default',true) }}"
      Data Network 9: "{{ data_network9.se_int_pg | default('default',true) }}"
    properties:
      AVICNTRL: '{{ avi_credentials.controller }}'
      AVICNTRL_AUTHTOKEN: '{{ auth_token }}'
      AVICNTRL_CLUSTERUUID: '{{ cluster_uuid }}'
      avi.mgmt-ip.SE: "{{ se_mgmt_ip | default(omit) }}"
      avi.mgmt-mask.SE: "{{ se_mgmt_mask | default(omit) }}"
      avi.default-gw.SE: "{{ se_mgmt_gw| default(omit) }}"
    power_on: no
    ova: "{{ ova_path }}"
  register: se_status
  delegate_to: "localhost"
  loop: "{{ range(0, item.numberOfSe, 1) | list }}"
  when:
    - no_access is defined

- debug:
    msg: "{{ se_status }}"
